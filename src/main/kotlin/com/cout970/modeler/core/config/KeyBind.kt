package com.cout970.modeler.core.config

import com.cout970.glutilities.device.Keyboard
import com.cout970.glutilities.device.Keyboard.Companion.KEY_0
import com.cout970.glutilities.device.Keyboard.Companion.KEY_1
import com.cout970.glutilities.device.Keyboard.Companion.KEY_2
import com.cout970.glutilities.device.Keyboard.Companion.KEY_3
import com.cout970.glutilities.device.Keyboard.Companion.KEY_4
import com.cout970.glutilities.device.Keyboard.Companion.KEY_5
import com.cout970.glutilities.device.Keyboard.Companion.KEY_6
import com.cout970.glutilities.device.Keyboard.Companion.KEY_7
import com.cout970.glutilities.device.Keyboard.Companion.KEY_8
import com.cout970.glutilities.device.Keyboard.Companion.KEY_9
import com.cout970.glutilities.device.Keyboard.Companion.KEY_A
import com.cout970.glutilities.device.Keyboard.Companion.KEY_APOSTROPHE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_B
import com.cout970.glutilities.device.Keyboard.Companion.KEY_BACKSLASH
import com.cout970.glutilities.device.Keyboard.Companion.KEY_BACKSPACE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_C
import com.cout970.glutilities.device.Keyboard.Companion.KEY_CAPS_LOCK
import com.cout970.glutilities.device.Keyboard.Companion.KEY_COMMA
import com.cout970.glutilities.device.Keyboard.Companion.KEY_D
import com.cout970.glutilities.device.Keyboard.Companion.KEY_DELETE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_DOWN
import com.cout970.glutilities.device.Keyboard.Companion.KEY_E
import com.cout970.glutilities.device.Keyboard.Companion.KEY_END
import com.cout970.glutilities.device.Keyboard.Companion.KEY_ENTER
import com.cout970.glutilities.device.Keyboard.Companion.KEY_EQUAL
import com.cout970.glutilities.device.Keyboard.Companion.KEY_ESCAPE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F1
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F10
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F11
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F12
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F13
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F14
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F15
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F16
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F17
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F18
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F19
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F2
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F20
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F21
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F22
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F23
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F24
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F25
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F3
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F4
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F5
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F6
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F7
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F8
import com.cout970.glutilities.device.Keyboard.Companion.KEY_F9
import com.cout970.glutilities.device.Keyboard.Companion.KEY_G
import com.cout970.glutilities.device.Keyboard.Companion.KEY_GRAVE_ACCENT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_H
import com.cout970.glutilities.device.Keyboard.Companion.KEY_HOME
import com.cout970.glutilities.device.Keyboard.Companion.KEY_I
import com.cout970.glutilities.device.Keyboard.Companion.KEY_INSERT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_J
import com.cout970.glutilities.device.Keyboard.Companion.KEY_K
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_0
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_1
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_2
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_3
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_4
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_5
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_6
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_7
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_8
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_9
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_ADD
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_DECIMAL
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_DIVIDE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_ENTER
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_EQUAL
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_MULTIPLY
import com.cout970.glutilities.device.Keyboard.Companion.KEY_KP_SUBTRACT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_L
import com.cout970.glutilities.device.Keyboard.Companion.KEY_LEFT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_LEFT_ALT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_LEFT_BRACKET
import com.cout970.glutilities.device.Keyboard.Companion.KEY_LEFT_CONTROL
import com.cout970.glutilities.device.Keyboard.Companion.KEY_LEFT_SHIFT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_LEFT_SUPER
import com.cout970.glutilities.device.Keyboard.Companion.KEY_M
import com.cout970.glutilities.device.Keyboard.Companion.KEY_MENU
import com.cout970.glutilities.device.Keyboard.Companion.KEY_MINUS
import com.cout970.glutilities.device.Keyboard.Companion.KEY_N
import com.cout970.glutilities.device.Keyboard.Companion.KEY_NUM_LOCK
import com.cout970.glutilities.device.Keyboard.Companion.KEY_O
import com.cout970.glutilities.device.Keyboard.Companion.KEY_P
import com.cout970.glutilities.device.Keyboard.Companion.KEY_PAGE_DOWN
import com.cout970.glutilities.device.Keyboard.Companion.KEY_PAGE_UP
import com.cout970.glutilities.device.Keyboard.Companion.KEY_PAUSE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_PERIOD
import com.cout970.glutilities.device.Keyboard.Companion.KEY_PRINT_SCREEN
import com.cout970.glutilities.device.Keyboard.Companion.KEY_Q
import com.cout970.glutilities.device.Keyboard.Companion.KEY_R
import com.cout970.glutilities.device.Keyboard.Companion.KEY_RIGHT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_RIGHT_ALT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_RIGHT_BRACKET
import com.cout970.glutilities.device.Keyboard.Companion.KEY_RIGHT_CONTROL
import com.cout970.glutilities.device.Keyboard.Companion.KEY_RIGHT_SHIFT
import com.cout970.glutilities.device.Keyboard.Companion.KEY_RIGHT_SUPER
import com.cout970.glutilities.device.Keyboard.Companion.KEY_S
import com.cout970.glutilities.device.Keyboard.Companion.KEY_SCROLL_LOCK
import com.cout970.glutilities.device.Keyboard.Companion.KEY_SEMICOLON
import com.cout970.glutilities.device.Keyboard.Companion.KEY_SLASH
import com.cout970.glutilities.device.Keyboard.Companion.KEY_SPACE
import com.cout970.glutilities.device.Keyboard.Companion.KEY_T
import com.cout970.glutilities.device.Keyboard.Companion.KEY_TAB
import com.cout970.glutilities.device.Keyboard.Companion.KEY_U
import com.cout970.glutilities.device.Keyboard.Companion.KEY_UP
import com.cout970.glutilities.device.Keyboard.Companion.KEY_V
import com.cout970.glutilities.device.Keyboard.Companion.KEY_W
import com.cout970.glutilities.device.Keyboard.Companion.KEY_WORLD_1
import com.cout970.glutilities.device.Keyboard.Companion.KEY_WORLD_2
import com.cout970.glutilities.device.Keyboard.Companion.KEY_X
import com.cout970.glutilities.device.Keyboard.Companion.KEY_Y
import com.cout970.glutilities.device.Keyboard.Companion.KEY_Z
import com.cout970.glutilities.event.EventKeyUpdate
import com.cout970.modeler.input.event.IInput
import org.lwjgl.glfw.GLFW

/**
 * Created by cout970 on 2016/12/17.
 */
class KeyBind(val keycode: Int, vararg val mods: KeyboardModifiers) {

    fun check(input: IInput): Boolean = input.keyboard.isKeyPressed(keycode) && mods.all { it.check(input) }
    fun check(event: EventKeyUpdate): Boolean = event.keycode == keycode && mods.all { it.check(event) }

    override fun toString(): String {
        var prefix = ""
        if (mods.isNotEmpty()) {
            prefix = mods.joinToString(" + ") + " + "
        }
        return prefix + GLFW.glfwGetKeyName(keycode, keycode)
    }
}

enum class KeyboardModifiers(val id: Int, val mask: Int) {
    CTRL(Keyboard.KEY_LEFT_CONTROL, GLFW.GLFW_MOD_CONTROL),
    SHIFT(Keyboard.KEY_LEFT_SHIFT, GLFW.GLFW_MOD_SHIFT),
    ALT(Keyboard.KEY_LEFT_ALT, GLFW.GLFW_MOD_ALT),
    SUPER(Keyboard.KEY_LEFT_SUPER, GLFW.GLFW_MOD_SUPER);

    fun check(input: IInput) = input.keyboard.isKeyPressed(id)
    fun check(event: EventKeyUpdate) = (event.mods and mask) == mask
}

fun KeyBind.getName(): String {
    val key = when (keycode) {
        KEY_SPACE -> "space"
        KEY_APOSTROPHE -> "'"
        KEY_COMMA -> ","
        KEY_MINUS -> "-"
        KEY_PERIOD -> "."
        KEY_SLASH -> "/"
        KEY_0 -> "0"
        KEY_1 -> "1"
        KEY_2 -> "2"
        KEY_3 -> "3"
        KEY_4 -> "4"
        KEY_5 -> "5"
        KEY_6 -> "6"
        KEY_7 -> "7"
        KEY_8 -> "8"
        KEY_9 -> "9"
        KEY_SEMICOLON -> ";"
        KEY_EQUAL -> "="
        KEY_A -> "a"
        KEY_B -> "b"
        KEY_C -> "c"
        KEY_D -> "d"
        KEY_E -> "e"
        KEY_F -> "f"
        KEY_G -> "g"
        KEY_H -> "h"
        KEY_I -> "i"
        KEY_J -> "j"
        KEY_K -> "k"
        KEY_L -> "l"
        KEY_M -> "m"
        KEY_N -> "n"
        KEY_O -> "o"
        KEY_P -> "p"
        KEY_Q -> "q"
        KEY_R -> "r"
        KEY_S -> "s"
        KEY_T -> "t"
        KEY_U -> "u"
        KEY_V -> "v"
        KEY_W -> "w"
        KEY_X -> "x"
        KEY_Y -> "y"
        KEY_Z -> "z"
        KEY_LEFT_BRACKET -> "["
        KEY_BACKSLASH -> "\\"
        KEY_RIGHT_BRACKET -> "]"
        KEY_GRAVE_ACCENT -> "`"
        KEY_WORLD_1 -> "world 1"
        KEY_WORLD_2 -> "world 2"
        KEY_ESCAPE -> "escape"
        KEY_ENTER -> "enter"
        KEY_TAB -> "tab"
        KEY_BACKSPACE -> "backspace"
        KEY_INSERT -> "inert"
        KEY_DELETE -> "delete"
        KEY_RIGHT -> "right"
        KEY_LEFT -> "left"
        KEY_DOWN -> "down"
        KEY_UP -> "up"
        KEY_PAGE_UP -> "page up"
        KEY_PAGE_DOWN -> "page down"
        KEY_HOME -> "home"
        KEY_END -> "end"
        KEY_CAPS_LOCK -> "caps lock"
        KEY_SCROLL_LOCK -> "scroll lock"
        KEY_NUM_LOCK -> "num lock"
        KEY_PRINT_SCREEN -> "print"
        KEY_PAUSE -> "pause"
        KEY_F1 -> "f1"
        KEY_F2 -> "f2"
        KEY_F3 -> "f3"
        KEY_F4 -> "f4"
        KEY_F5 -> "f5"
        KEY_F6 -> "f6"
        KEY_F7 -> "f7"
        KEY_F8 -> "f8"
        KEY_F9 -> "f9"
        KEY_F10 -> "f10"
        KEY_F11 -> "f11"
        KEY_F12 -> "f12"
        KEY_F13 -> "f13"
        KEY_F14 -> "f14"
        KEY_F15 -> "f15"
        KEY_F16 -> "f16"
        KEY_F17 -> "f17"
        KEY_F18 -> "f18"
        KEY_F19 -> "f19"
        KEY_F20 -> "f20"
        KEY_F21 -> "f21"
        KEY_F22 -> "f22"
        KEY_F23 -> "f23"
        KEY_F24 -> "f24"
        KEY_F25 -> "f25"
        KEY_KP_0 -> "num pad 0"
        KEY_KP_1 -> "num pad 1"
        KEY_KP_2 -> "num pad 2"
        KEY_KP_3 -> "num pad 3"
        KEY_KP_4 -> "num pad 4"
        KEY_KP_5 -> "num pad 5"
        KEY_KP_6 -> "num pad 6"
        KEY_KP_7 -> "num pad 7"
        KEY_KP_8 -> "num pad 8"
        KEY_KP_9 -> "num pad 9"
        KEY_KP_DECIMAL -> "num pad ."
        KEY_KP_DIVIDE -> "num pad /"
        KEY_KP_MULTIPLY -> "num pad *"
        KEY_KP_SUBTRACT -> "num pad -"
        KEY_KP_ADD -> "num pad +"
        KEY_KP_ENTER -> "num pad enter"
        KEY_KP_EQUAL -> "num pad equal"
        KEY_LEFT_SHIFT -> "left shift"
        KEY_LEFT_CONTROL -> "left ctrl"
        KEY_LEFT_ALT -> "left alt"
        KEY_LEFT_SUPER -> "left super"
        KEY_RIGHT_SHIFT -> "right shift"
        KEY_RIGHT_CONTROL -> "right ctrl"
        KEY_RIGHT_ALT -> "right alt"
        KEY_RIGHT_SUPER -> "right super"
        KEY_MENU -> "menu"
        else -> "Unknown key"
    }
    return if (mods.isNotEmpty()) {
        key.toUpperCase() + " + " + mods.joinToString(", ")
    } else {
        key.toUpperCase()
    }
}